// title: Generated Jar
// author: Kevin Mamaqi Kapllani
// license: MIT Licenser
// description: Generated Jar for TfCD Assignement. TU Delft - ACD. 2017-18. Based on the jar-barrel from Eduard Bespalov.

// Here we define the user editable parameters:
function getParameterDefinitions() {
  return [
    { name: 'widthParameter', caption: 'Jar diameter:', type: 'float', default: 30 },
    { name: 'heightParameter', caption: 'Jar height:', type: 'float', default: 50 },
    { name: 'rParameter', caption: 'r color:', type: 'float', default: 0.8 },
    { name: 'gParameter', caption: 'g color:', type: 'float', default: 0.2 },
    { name: 'bParameter', caption: 'b color:', type: 'float', default: 0.3 },
    { name: 'scaleArray', caption: 'scale:', type: 'text', default: "0.883,0.8979354026666667,0.9122656213333333,0.925996672,0.9391345706666666,0.9516853333333334,0.963654976,0.9750495146666667,0.9858749653333333,0.9961373439999999,1.0058426666666667,1.0149969493333333,1.023606208,1.0316764586666667,1.0392137173333333,1.046224,1.0527133226666667,1.0586877013333331,1.064153152,1.0691156906666666,1.0735813333333335,1.0775560960000001,1.0810459946666668,1.0840570453333334,1.0865952639999998,1.088666666666667,1.0902772693333334,1.091433088,1.092140138666667,1.0924044373333333,1.0922319999999999,1.0916288426666667,1.0906009813333333,1.089154432,1.0872952106666665,1.0850293333333334,1.082362816,1.0793016746666666,1.0758519253333332,1.072019584,1.0678106666666667,1.0632311893333335,1.058287168,1.0529846186666667,1.0473295573333334,1.041328,1.0349859626666666,1.0283094613333332,1.021304512,1.0139771306666665,1.0063333333333335,0.9983791360000001,0.9901205546666667,0.9815636053333333,0.972714304,0.9635786666666666,0.9541627093333334,0.944472448,0.9345138986666667,0.9242930773333333,0.913816,0.9030886826666666,0.8921171413333333,0.880907392,0.8694654506666666,0.8577973333333333,0.845909056,0.8338066346666667,0.8214960853333333,0.808983424,0.7962746666666667,0.7833758293333333,0.770292928,0.7570319786666666,0.7435989973333332,0.73" },
    { name: 'rotateArray', caption: 'rotate:', type: 'text', default: "1.243,1.2258554666666668,1.2096869333333333,1.194472,1.1801882666666668,1.1668133333333333,1.1543248000000002,1.1427002666666666,1.1319173333333334,1.1219535999999999,1.1127866666666666,1.1043941333333334,1.0967536,1.0898426666666667,1.0836389333333334,1.0781200000000002,1.0732634666666667,1.0690469333333332,1.065448,1.0624442666666667,1.0600133333333335,1.0581328,1.0567802666666668,1.0559333333333334,1.0555696,1.0556666666666668,1.0562021333333333,1.0571536000000001,1.0584986666666667,1.0602149333333333,1.0622800000000001,1.0646714666666668,1.0673669333333333,1.0703440000000002,1.0735802666666665,1.0770533333333332,1.0807408,1.0846202666666667,1.0886693333333333,1.0928656,1.0971866666666668,1.1016101333333335,1.1061136,1.1106746666666667,1.1152709333333335,1.11988,1.1244794666666666,1.1290469333333335,1.1335600000000001,1.1379962666666668,1.1423333333333334,1.1465488000000001,1.1506202666666667,1.1545253333333334,1.1582416,1.1617466666666667,1.1650181333333334,1.1680336,1.1707706666666666,1.1732069333333335,1.17532,1.1770874666666669,1.1784869333333334,1.1794959999999999,1.1800922666666667,1.1802533333333334,1.1799568,1.1791802666666666,1.1779013333333335,1.1760975999999999,1.1737466666666667,1.1708261333333334,1.1673136000000002,1.1631866666666668,1.1584229333333333,1.153" }
  ];
}


function main(params) {
  var radius = params.widthParameter / 2;
  var height = params.heightParameter;
  var R = params.rParameter;
  var G = params.gParameter;
  var B = params.bParameter;
  var scaleArray = params.scaleArray.split(",").map(function (item) {
    return item;
  });
  var rotateArray = params.rotateArray.split(",").map(function (item) {
    return item;
  });
  var thick = 1.5;
  var bottomThick = 2;
   
  var jar = hexTwisted(radius, height, R, G, B, scaleArray, rotateArray)
    .subtract(hexTwisted( radius - thick, height - bottomThick, R, G, B, scaleArray, rotateArray)
    //rotate because jar is already rotated on that level
    //otherwise will gebt holes
    // .rotateZ((bottomThick / height))
    .translate([0,0,bottomThick]) //make jar bottom

  );
  return jar;
}


function hexTwisted(radius, height, r, g, b, scaleArray,rotateArray) {
  var sqrt3 = Math.sqrt(3) / 2;
  var cag = CAG.fromPoints([
      [radius, 0, 0],
      [radius / 2, radius * sqrt3, 0],
      [-radius / 2, radius * sqrt3, 0],
      [-radius, 0, 0],
      [-radius / 2, -radius * sqrt3, 0],
      [radius / 2, -radius * sqrt3, 0]
   ]).expand(4, CSG.defaultResolution2D);

  var flatBottom = CSG.Polygon.createFromPoints(
    cag.getOutlinePaths()[0].points
  );

  var hex = flatBottom.solidFromSlices({
  numslices: Math.round(height*1.5)
  ,callback: function(t,slice) {
    var coef = scaleArray[slice];
    var polygon = this.rotateZ(rotateArray[slice] * 150)
            .translate([0, 0, height * t])
            .scale([coef, coef, 1]);
    return polygon;
    }
  });
   return hex.setColor([r,g,b]);
}
